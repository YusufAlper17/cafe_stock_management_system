<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raporlar - Bakery Cafe Stock</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar fixed-top">
        <div class="container-fluid">
            <button class="btn btn-link" id="toggleSidebar">
                <i class="bi bi-list"></i>
            </button>
            <span class="navbar-brand">Bakery Cafe Stock</span>
            <div class="d-flex align-items-center">
                <span class="me-3" id="userInfo"></span>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Logo -->
        <div class="sidebar-logo">
            <img src="images/logo.svg" alt="Arzen Cafe">
            <span class="logo-text">Arzen Cafe</span>
        </div>
        
        <!-- Main Menu -->
        <ul class="sidebar-menu">
            <li>
                <a href="/dashboard" class="sidebar-menu-item">
                    <i class="bi bi-speedometer2"></i><span data-i18n="nav.dashboard">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/sales" class="sidebar-menu-item">
                    <i class="bi bi-cart3"></i><span data-i18n="nav.sales">Satış</span>
                </a>
            </li>
            <li>
                <a href="/stock" class="sidebar-menu-item">
                    <i class="bi bi-box-seam"></i><span data-i18n="nav.stock">Stok</span>
                </a>
            </li>
            <li>
                <a href="/reports" class="sidebar-menu-item active">
                    <i class="bi bi-graph-up"></i><span>Raporlar</span>
                </a>
            </li>
            <li>
                <a href="/archive" class="sidebar-menu-item">
                    <i class="bi bi-archive"></i><span>Arşiv</span>
                </a>
            </li>
        </ul>
        
        <!-- Settings Section -->
        <div class="sidebar-settings">
            <a href="#" class="settings-item" id="toggleTheme">
                <i class="bi bi-moon"></i><span>Tema</span>
            </a>
            <a href="#" class="settings-item" id="langToggle">
                <i class="bi bi-translate"></i><span>Dil</span>
            </a>
            <a href="#" class="settings-item" id="logoutBtn">
                <i class="bi bi-box-arrow-right"></i><span>Çıkış</span>
            </a>
        </div>
    </div>

    <!-- Content -->
    <div class="content">
        <div class="container-fluid">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0 fw-bold" data-i18n="reports.title">Reports & Analytics</h1>
                <div class="btn-group shadow-sm">
                    <button class="btn btn-outline-primary" id="exportPdf">
                        <i class="bi bi-file-pdf me-2"></i><span data-i18n="reports.exportPDF">PDF</span>
                    </button>
                    <button class="btn btn-outline-success" id="exportExcel">
                        <i class="bi bi-file-excel me-2"></i><span data-i18n="reports.exportExcel">Excel</span>
                    </button>
                </div>
            </div>

            <!-- Date Range Filter -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="input-group shadow-sm">
                        <span class="input-group-text bg-light border-end-0">
                            <i class="bi bi-calendar-range"></i>
                        </span>
                        <input type="date" class="form-control border-start-0" id="startDate">
                        <span class="input-group-text bg-light">-</span>
                        <input type="date" class="form-control" id="endDate">
                        <button class="btn btn-primary" id="filterDate" data-i18n="action.filter">Filter</button>
                    </div>
                    <!-- Quick Date Filters -->
                    <div class="mt-2 d-flex gap-2 flex-wrap">
                        <button class="btn btn-outline-secondary btn-sm" id="todayFilter">
                            <i class="bi bi-calendar-check me-1"></i><span data-i18n="reports.today">Today</span>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" id="yesterdayFilter">
                            <i class="bi bi-calendar-minus me-1"></i><span data-i18n="reports.yesterday">Yesterday</span>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" id="lastWeekFilter">
                            <i class="bi bi-calendar-week me-1"></i><span data-i18n="reports.last7days">Last 7 Days</span>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" id="lastMonthFilter">
                            <i class="bi bi-calendar-month me-1"></i><span data-i18n="reports.last30days">Last 30 Days</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-currency-dollar fs-4 text-primary me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.totalSales">Total Sales</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold" id="totalSales">0.00 ₺</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-graph-up-arrow fs-4 text-success me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.totalProfit">Total Profit</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold text-success" id="totalProfit">0.00 ₺</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-receipt fs-4 text-info me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.totalTransactions">Transactions</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold" id="totalTransactions">0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-cart-check fs-4 text-warning me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.averageBasket">Average Basket</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold" id="averageBasket">0.00 ₺</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-box fs-4 text-secondary me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.totalQuantity">Total Quantity</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold" id="totalQuantity">0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-calculator fs-4 text-secondary me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.averageQuantity">Average Quantity</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold" id="averageQuantity">0</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-percent fs-4 text-success me-2"></i>
                                <h6 class="card-subtitle mb-0 text-muted" data-i18n="reports.averageProfit">Average Profit</h6>
                            </div>
                            <h4 class="card-title mb-0 fw-bold text-success" id="averageProfit">0.00 ₺</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row g-4 mb-4">
                <!-- Sales Chart -->
                <div class="col-lg-8">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title mb-0 fw-bold" data-i18n="reports.dailySales">Daily Sales</h5>
                                <div class="d-flex gap-2 align-items-center">
                                    <select id="chartParam" class="form-select form-select-sm" style="width: auto;">
                                        <option value="all">All</option>
                                        <option value="sales">Sales only</option>
                                        <option value="profit">Profit only</option>
                                        <option value="count">Count only</option>
                                    </select>
                                </div>
                            </div>
                            <div style="height: 300px;">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Products Chart -->
                <div class="col-lg-4">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title mb-0 fw-bold" data-i18n="reports.topProducts">Top Selling Products</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="topProductsFilter" data-bs-toggle="dropdown">
                                        <i class="bi bi-funnel"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item active" href="#" data-filter="revenue" data-i18n="reports.byRevenue">By Revenue</a></li>
                                        <li><a class="dropdown-item" href="#" data-filter="quantity" data-i18n="reports.byQuantity">By Quantity</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div style="height: 300px;">
                                <canvas id="topProductsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales History -->
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0 fw-bold" data-i18n="reports.salesHistory">Sales History</h5>
                        <button class="btn btn-sm btn-outline-primary" id="exportSales">
                            <i class="bi bi-download me-1"></i>
                            <span data-i18n="action.export">Export</span>
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th data-i18n="reports.date">Date</th>
                                    <th data-i18n="reports.products">Products</th>
                                    <th data-i18n="sales.total">Total</th>
                                    <th data-i18n="reports.profit">Profit</th>
                                    <th data-i18n="stock.actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody">
                                <!-- Sales will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sale Details Modal -->
    <div class="modal fade" id="saleDetailsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" data-i18n="reports.saleDetails">Sale Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th data-i18n="stock.productName">Product</th>
                                    <th data-i18n="sales.quantity">Quantity</th>
                                    <th data-i18n="sales.unitPrice">Unit Price</th>
                                    <th data-i18n="sales.total">Total</th>
                                </tr>
                            </thead>
                            <tbody id="saleDetailsTableBody">
                                <!-- Sale details will be populated by JavaScript -->
                            </tbody>
                            <tfoot class="border-top">
                                <tr>
                                    <td colspan="3" class="text-end fw-medium" data-i18n="sales.subtotal">Subtotal:</td>
                                    <td class="fw-bold" id="saleSubtotal">0.00 ₺</td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-end fw-medium" data-i18n="sales.tax">VAT (18%):</td>
                                    <td class="fw-medium" id="saleTax">0.00 ₺</td>
                                </tr>
                                <tr class="border-top">
                                    <td colspan="3" class="text-end fw-bold fs-6" data-i18n="sales.total">Total:</td>
                                    <td class="fw-bold fs-6 text-primary" id="saleTotal">0.00 ₺</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="action.close">Close</button>
                    <button type="button" class="btn btn-primary" id="printSaleDetails">
                        <i class="bi bi-printer me-2"></i><span data-i18n="action.print">Print</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/reports.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeBtn = document.getElementById('toggleTheme');
            if (themeBtn) themeBtn.addEventListener('click', Theme.toggle);
            
            const langToggle = document.getElementById('langToggle');
            if (langToggle) {
                langToggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    const currentLang = document.documentElement.lang;
                    const newLang = currentLang === 'tr' ? 'en' : 'tr';
                    document.documentElement.lang = newLang;
                    ToastNotification.info(`Dil değiştirildi: ${newLang.toUpperCase()}`);
                });
            }

            // Sidebar hover behavior
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                let hoverTimeout;
                
                sidebar.addEventListener('mouseenter', () => {
                    clearTimeout(hoverTimeout);
                    sidebar.classList.add('hovered');
                });
                
                sidebar.addEventListener('mouseleave', () => {
                    hoverTimeout = setTimeout(() => {
                        sidebar.classList.remove('hovered');
                    }, 100);
                });
            }
        });
    </script>
</body>
</html> 